dist: trusty

language: node_js

node_js: '11'

branches:
  only:
    - master

deploy:
  api_key:
    secure: mcZxmZtB8ry1c21FBJeep8kOt7LRjfUvjfNQnTaU92BV2MCZDGH32GODjbYpKLw/GXiv3MeEL5jDoAZMe/d5eOqaGSHYMTzDXEDurutjEwOn7wTJZWT9yh70WuZ9pA9x08WVk5vlnkHOv8Mo3b1PVrILpdM+SKf1qGLdW7epvJcSDK8QoRFvEzEzM0L8Ja/lAldGrB0VZDI5hGLVKCNmJMmkMCFgpSfS3vVCghLqy0Ly5lJtQfyScH+Yz0hlorhdHkD1ogXKG43NQuVdG/i0fD4zjT7tQC36sRbK/wr1VmgPVNqjIXZfs4dX4gDosTr0tbQVBzPhSsgcOyxG0PNhuv8PZ3hSpU2kwvBb6stGjqXQr7c0+5BhkmW1fWmJTmi3WOgg4Fz29lo+8oYjJj3lAsQSr/VHWYXqFxw8SRoL20QRHw96ici/KSYSRF38u6lRxXeZdE5ipoxBcTUsmkrUVtb+U4eoukxwRoUOwGruplnzRoQV6z/SGItblFlaVF/v3A8Ialvhfp5VjaYGjl8ghErmVYU/1+0Xi5DaPCX6uLYr0fLybxUjBmBiAGLvYGtUw9IovZooWWff5KRfvRfd3+OQOzB4ZuLiJV5dkBU4aqGZmMDvoNgYmBfywIN4VZwMRWo4lnF7hoNLoHvFCbp3/ox/IJkhDvwPt9jtQtXfi3c=
  on:
    branch: master

notifications:
  slack: jHCpLkDg5iqqyj5PfRhmaj6xN2wS2kxr097WmXDVNzqGKgRAL7iiqdiI75a2RX7yuKtwfJEEi3+3ET2QagRylmGsWu+tLI5g4+7S/1FaZb9KDdSq4Zl8LxDjKC/eYbwJyN6ppQWxOIly1JRXVvY30SJ/TWRrTBLY/BDyC1CmdKvILxJF1HgfLE3AaV/tovdL8+aLaE9zaTkTIlck11u2fiNae1qj6xM3Va7ktjg10mSv2DxoNPuB8GAKQaLWvg2hG/gRUJyYGbC77ery/sS5Q1ur+6zClqSgQF5PiKkzuMCbIilJgO7RSTVRM4lEFe4bdW9locX1kZHge1IxM21bhpDEj9oFYUfGHjtV4NAhD5gTiLMYHHGIyAbClO36QDuuA7zmb/CdUCFTicGFVCMZrfkMPc1dSViLQKPObs2au4EO8tAOcFqFE1Q8IZp7XsvFhN+K/MmD3WvYHNk+mVfQeeFiLV0hcNBZQxCIac6CrBEgL92l2fwS/F3cHuEIHpTNLgHfZBVgtzrMV1nWjfM2rcKB25zOCsmm60viVqcdHrlyyhugat0KH8l21QRPHrgaUttjLHL86z1QKNISk4aEvRZiOnC1n0NYschlttrh4Z7bwx4d1Lgyj+GYkklZkkhh7lCogxh63V620m8KjnasUlvt7l76MBXmeCe1YF/GnrI=

jobs:
  include:
    - stage: test
      script: npm run test
    - script: npm run lint
    - stage: analyse
      script: npm install sonar-scanner --no-save
        && npx jest --coverage
        && npx eslint -f json -o reports/eslint.json .
        && npx sonar-scanner
        -Dsonar.organization=flowscripter
        -Dsonar.projectKey=flowscripter_eslint-config
        -Dsonar.sources=src
        -Dsonar.tests=test
        -Dsonar.host.url=https://sonarcloud.io
        -Dsonar.login=$SONAR_TOKEN
