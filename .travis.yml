language: node_js
node_js: '11'
branches:
  only:
  - master
notifications:
  slack:
    secure: htEU3VYK0wUjaUetVG28Wt722xTQUcPy7VQJ8eXA1Mg4TFfiNkkbTN3KD8B4+jnwalIxI24h/iRAb6OoQlS7Za5ZaCi5/+rbT2wbo5u/XxWukr55IvnZ8Bttb6rGUZUHsoK7EsaU4Jr5xWrd1Q9Hw/L3hp3hjBvT1bsNclq410hoVLrcieR7WL152wQTApOREioJYaEfCVEJYL3y+9Rupj5DPgoI8xiRbmaA3m4X02tuadHwZ0dk4zlllJ0sc0SokMObNBBj/s2Z+6m+sxzprhh4PK7ohon6QC0SgchJiBUR7h3B/5Zzg35RtzOAVq5AyFbMKEsh1hNdhebG8s/Fs7wNSmHSMem/v8ZFGinUfzBy1Wp3+EwNoP7incKhu7r3hqh/yuXxKu26sZYpHBKy6ovLyi6t09xUE2/jwXN/Yq3t+HntJaeV71QMcMqpBKpcTDQ02LEREYAZTBbrsIZ7P7HiYcDS3pVL08JQ0+Df+P3g8ysArHdbsShshGyNpLSZtHceBZj6zKMe8UWRaiBGciif+VpgQRPlRwx2Gw21lrDLYRwbl4uQqWWv0R3ygk3iMrJ9t/NjII1zWZ5KKj3jyd1okDENgsu2/V7PfcmSbYNSqMQJcAGUeoUdebtyXBr82Xw7KVhrfdGjoCFHG6IvbqRPgurqyjnIXo/jPHa44Gc=
    on_success: change
    on_failure: always
stages:
- name: release
  if: branch = master AND type != pull_request
jobs:
  include:
  - stage: test
    script: npm test
    name: test
  - script: npm run lint
    name: lint
  - stage: analysis
    script: npx jest --coverage && npx eslint -f json -o reports/eslint.json . && npx gulp sonar
    name: sonar
    addons:
      sonarcloud:
        organization: flowscripter
        token:
          secure: "$SONAR_TOKEN"
  - stage: release
    deploy:
      provider: script
      skip_cleanup: true
      script:
      - npx semantic-release
