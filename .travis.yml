dist: trusty

language: node_js

node_js: '11'

branches:
  only:
    - master

notifications:
  slack:
    rooms:
      - secure: jHCpLkDg5iqqyj5PfRhmaj6xN2wS2kxr097WmXDVNzqGKgRAL7iiqdiI75a2RX7yuKtwfJEEi3+3ET2QagRylmGsWu+tLI5g4+7S/1FaZb9KDdSq4Zl8LxDjKC/eYbwJyN6ppQWxOIly1JRXVvY30SJ/TWRrTBLY/BDyC1CmdKvILxJF1HgfLE3AaV/tovdL8+aLaE9zaTkTIlck11u2fiNae1qj6xM3Va7ktjg10mSv2DxoNPuB8GAKQaLWvg2hG/gRUJyYGbC77ery/sS5Q1ur+6zClqSgQF5PiKkzuMCbIilJgO7RSTVRM4lEFe4bdW9locX1kZHge1IxM21bhpDEj9oFYUfGHjtV4NAhD5gTiLMYHHGIyAbClO36QDuuA7zmb/CdUCFTicGFVCMZrfkMPc1dSViLQKPObs2au4EO8tAOcFqFE1Q8IZp7XsvFhN+K/MmD3WvYHNk+mVfQeeFiLV0hcNBZQxCIac6CrBEgL92l2fwS/F3cHuEIHpTNLgHfZBVgtzrMV1nWjfM2rcKB25zOCsmm60viVqcdHrlyyhugat0KH8l21QRPHrgaUttjLHL86z1QKNISk4aEvRZiOnC1n0NYschlttrh4Z7bwx4d1Lgyj+GYkklZkkhh7lCogxh63V620m8KjnasUlvt7l76MBXmeCe1YF/GnrI=
    on_success: change
    on_failure: always

jobs:
  include:
    - stage: test
      script: npm test
      name: test
    - script: npm run lint
      name: lint
    - stage: analysis
      script: npx jest --coverage
        && npx eslint -f json -o reports/eslint.json .
        && npx gulp sonar
      name: sonar
      addons:
        sonarcloud:
          organization: flowscripter
          token:
            secure: $SONAR_TOKEN
    - stage: release
      on:
        branch: master
      script: echo 'Releasing...'
      deploy:
        provider: script
        skip_cleanup: true
        script:
          - npx semantic-release
